import{r as s,j as e,b as j,a as E}from"./app-BEkiMP84.js";import{A as M}from"./app-layout-CXPyv5RY.js";/* empty css            */import"./app-logo-icon-CKSdECuW.js";import"./index-roqmlf9y.js";import"./index-Cfigfk6n.js";function K({onSelectMessage:i}){const[b,l]=s.useState([]),[x,m]=s.useState(!0),[y,h]=s.useState(null);s.useEffect(()=>{var r;if((async()=>{try{m(!0);const n=await j.get("/messages");l(n.data.messages)}catch(n){console.error("Error fetching messages:",n)}finally{m(!1)}})(),window.Echo){const n=window.Echo.private(`user.${(r=window.userInfo)==null?void 0:r.id}`);return n.listen(".message.sent",d=>{l(u=>[d.message,...u])}),n.listen(".message.received",d=>{l(u=>u.map(g=>g.identifier===d.message.identifier?d.message:g))}),()=>{n.stopListening(".message.sent"),n.stopListening(".message.received")}}},[]);const p=t=>{h(t.identifier),i(t),t.read_at||j.post(`/messages/${t.identifier}/read`)},c=t=>{try{const r=new Date(t),d=Math.floor((new Date().getTime()-r.getTime())/(1e3*60*60));return d<24?d===0?"Just now":`${d} hour${d===1?"":"s"} ago`:d<48?"Yesterday":r.toLocaleDateString()}catch(r){return"Unknown time:"+r.message}};return e.jsxs("div",{className:"p-4 h-full overflow-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Inbox"}),x?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):b.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No messages in your inbox"}):e.jsx("div",{className:"space-y-2",children:b.map(t=>{var r;return e.jsxs("div",{className:`p-3 border rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer ${y===t.identifier?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":""} ${t.read_at?"":"border-l-4 border-l-blue-500"}`,onClick:()=>p(t),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:((r=t.sender)==null?void 0:r.name)||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500",children:c(t.created_at)})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate mt-1",children:[t.read_at?"Read":"Unread"," - Encrypted message"]})]},t.identifier)})})]})}function D({selectedMessage:i}){var f;const[b,l]=s.useState(!1),[x,m]=s.useState(""),[y,h]=s.useState(""),[p,c]=s.useState(""),[t,r]=s.useState(""),[n,d]=s.useState(!1);s.useEffect(()=>{l(!1),m(""),h(""),c(""),r("")},[i]);const u=async()=>{if(!i||!x.trim()){r("Please enter your private key");return}d(!0),r("");try{const o=await j.post("/messages/decrypt",{identifier:i.identifier,private_key:x});h(o.data.content),l(!0),i.expires_at&&g(i.expires_at)}catch(o){console.error("Error decrypting message:",o),r("Failed to decrypt message. Please check your private key.")}finally{d(!1)}},g=o=>{const a=new Date(o),v=()=>{var N;const w=new Date;if(a>w){const S=Math.floor((a.getTime()-w.getTime())/1e3);c(`${S} seconds remaining`),S<=10&&((N=document.getElementById("countdown-timer"))==null||N.classList.add("text-red-600"))}else c("Expired"),clearInterval(k),l(!1),m(""),h("")};v();const k=setInterval(v,1e3)};return i?e.jsxs("div",{className:"p-4 h-full",children:[e.jsxs("h2",{className:"text-xl font-semibold tracking-tight mb-4",children:["Message from ",((f=i.sender)==null?void 0:f.name)||"Unknown"]}),b?e.jsxs("div",{children:[p&&e.jsxs("div",{className:"mb-4 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Self-destructing message:"}),e.jsx("span",{id:"countdown-timer",className:"text-sm font-bold",children:p})]}),e.jsx("div",{className:"mt-1 h-1 w-full bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-500",style:{width:`${Math.min(100,parseInt(p.split(" ")[0])/60*100)}%`,transition:"width 1s linear"}})})]}),e.jsx("div",{className:"p-3 border rounded-md bg-gray-50 dark:bg-gray-800 whitespace-pre-wrap",children:y})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This message is encrypted. Enter your private key to decrypt it."}),e.jsx("textarea",{className:"w-full p-2 border rounded-md h-32 font-mono text-sm",placeholder:"Paste your private key here",value:x,onChange:o=>m(o.target.value)}),t&&e.jsx("p",{className:"text-red-500 text-sm",children:t}),e.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:u,disabled:n,children:n?"Decrypting...":"Decrypt Message"})]})]}):e.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Select a message to view its contents"})})}function I(){const[i,b]=s.useState([]),[l,x]=s.useState(""),[m,y]=s.useState(""),[h,p]=s.useState("10"),[c,t]=s.useState(!1),[r,n]=s.useState(!1),[d,u]=s.useState(""),[g,f]=s.useState(!0);s.useEffect(()=>{(async()=>{try{f(!0);const v=await j.get("/users");b(v.data.users)}catch(v){console.error("Error fetching users:",v),u("Failed to load users. Please try again later.")}finally{f(!1)}})()},[]);const o=async()=>{if(!l){u("Please select a recipient");return}if(!m.trim()){u("Please enter a message");return}t(!0),u(""),n(!1);try{const a=new Date;a.setSeconds(a.getSeconds()+parseInt(h)),await j.post("/messages",{recipient_id:l,content:m,expires_at:a.toISOString()}),x(""),y(""),p("10"),n(!0),setTimeout(()=>{n(!1)},5e3)}catch(a){console.error("Error sending message:",a),u("Failed to send message. The recipient may not have generated encryption keys yet.")}finally{t(!1)}};return e.jsxs("div",{className:"p-4 h-full overflow-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"New Secret Message"}),r&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 text-green-800 rounded-md",children:"Message sent successfully!"}),d&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-800 rounded-md",children:d}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Recipient"}),g?e.jsx("div",{className:"animate-pulse h-10 bg-gray-200 rounded-md"}):e.jsxs("select",{className:"w-full p-2 border rounded-md",value:l,onChange:a=>x(a.target.value),disabled:c,children:[e.jsx("option",{value:"",children:"Select a recipient"}),i.map(a=>e.jsxs("option",{value:a.id.toString(),children:[a.name," (",a.email,")"]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Message"}),e.jsx("textarea",{className:"w-full p-2 border rounded-md h-24",placeholder:"Type your secret message here...",value:m,onChange:a=>y(a.target.value),disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Message Expiry Time (seconds)"}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{className:"p-2 border rounded-md",value:h,onChange:a=>p(a.target.value),disabled:c,children:[e.jsx("option",{value:"10",children:"10 seconds"}),e.jsx("option",{value:"15",children:"15 seconds"}),e.jsx("option",{value:"20",children:"20 seconds"}),e.jsx("option",{value:"25",children:"25 seconds"}),e.jsx("option",{value:"30",children:"30 seconds"}),e.jsx("option",{value:"35",children:"35 seconds"}),e.jsx("option",{value:"40",children:"40 seconds"}),e.jsx("option",{value:"45",children:"45 seconds"}),e.jsx("option",{value:"50",children:"50 seconds"}),e.jsx("option",{value:"55",children:"55 seconds"}),e.jsx("option",{value:"60",children:"60 seconds"})]})})]}),e.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 w-full disabled:opacity-50 disabled:cursor-not-allowed",onClick:o,disabled:c||g,children:c?"Sending...":"Send Secret Message"})]})]})}const C=[{title:"Dashboard",href:"/dashboard"}];function R({hasKeys:i}){const[b,l]=s.useState(null),[x,m]=s.useState(!i),[y,h]=s.useState(""),[p,c]=s.useState(""),[t,r]=s.useState(!1),[n,d]=s.useState(!1),u=async()=>{if(!t){r(!0);try{const o=await j.post("/keys/generate");h(o.data.private_key),c(o.data.public_key),d(!0)}catch(o){console.error("Error generating keys:",o)}finally{r(!1)}}},g=o=>{l(o)},f=()=>{(n||i)&&m(!1)};return e.jsxs(M,{breadcrumbs:C,children:[e.jsx(E,{title:"Dashboard"}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Encryption Keys"}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-yellow-100 text-yellow-800 rounded-md",children:[e.jsx("p",{className:"font-bold",children:"IMPORTANT: Save Your Private Key"}),e.jsx("p",{children:"Your private key is only shown once and is not stored on the server. Save it securely."}),e.jsx("p",{children:"You will need it to decrypt messages sent to you."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Your Private Key:"}),e.jsx("textarea",{className:"w-full p-2 border rounded-md h-32 font-mono text-sm",value:y,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Your Public Key:"}),e.jsx("textarea",{className:"w-full p-2 border rounded-md h-32 font-mono text-sm",value:p,readOnly:!0})]}),e.jsx("button",{className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",onClick:f,children:"I've Saved My Private Key"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"You need to generate encryption keys to send and receive secure messages."}),e.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:u,disabled:t,children:t?"Generating...":"Generate Keys"})]})]})}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"grid auto-rows-min gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"border-sidebar-border/70 dark:border-sidebar-border relative aspect-video overflow-hidden rounded-xl border",children:e.jsx(K,{onSelectMessage:g})}),e.jsx("div",{className:"border-sidebar-border/70 dark:border-sidebar-border relative aspect-video overflow-hidden rounded-xl border",children:e.jsx(D,{selectedMessage:b})})]}),e.jsx("div",{className:"border-sidebar-border/70 dark:border-sidebar-border relative aspect-video overflow-hidden rounded-xl border",children:e.jsx(I,{})})]})]})}export{R as default};
